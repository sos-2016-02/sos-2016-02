
<!DOCTYPE html>

<html lang="en">

  <head>
        <title>Workers Data </title>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

        <!-- Librerías Bootstrap: Estilos externos del sitio web -->
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <link type="text/css" rel="stylesheet" href="/css/workers/bootstrap.css"/>
        <link type="text/css" rel="stylesheet" href="/css/workers/bootstrap-table.css"/>
        <link type="text/css" rel="stylesheet" href="/css/workers/bootstrap-theme.css"/>
        <link type="text/css" rel="stylesheet" href="/css/workers/bootstrap.min.css"/>
       <script src="/js/workers/workers-gui2.js"></script>
        <script type="text/javascript">


        $(document).ready(function() {
  //llamadas que estoy haciendo a mi jquery or javascritp
  var operation = "C"; //"C"=Crear
  var selected_index = -1; // Indice de el elemento seleccionado en la lista
  var workers = sessionStorage.getItem("workers-data"); //Retornar los datos almacenados
    workers = JSON.parse(workers ); //Convertir String a Object
 var dobles_comillas = String.fromCharCode(34);
  if (workers  === null) // Si no hay datos, inicializar un array vacio
      workers  = [];

          function Mostrar() {
        var request = $.ajax({
                    url: "/api/v1/workers?apikey="+$("#api-key-input").val(),
                    type: "GET",
                    data: "",
                    dataType: "JSON",
                    contentType: "application/json"
                    });
        request.done(function(data,status,jqXHR){
    console.log(JSON.stringify(data));
    var table = makeTable(data);
    //Quiero mostrar todos los elemento de DOM
    //is dumped to the console window
    console.log(table[0].outerHTML);
    $("#workers-data").html(table);

  });

       request.always(function(jqXHR) {
        console.log( "Status:"+jqXHR.status);
       });
        return true;
      }




  function loadInitialData() {
    var request = $.ajax({
                url: "/api/v1/workers/loadInitialData?apikey="+$("#api-key-input").val(),
                type: "GET",
                data: "",
                dataType: "JSON",
                contentType: "application/json"
                });
    request.done(function(data,status,jqXHR){
    console.log(JSON.stringify(data));
    var table = makeTable(data);
    //Quiero mostrar todos los elemento de DOM
    //is dumped to the console window
    console.log(table[0].outerHTML);
    $("#workers-data").html(table);

  });

   request.always(function(jqXHR) {
    console.log( "Status:"+jqXHR.status);
   });
   if($("#api-key-input").val()!="sos"){
     alert("Error contraseña");
  } else{
    alert("Datos reseteados");
  }
    Mostrar();
    return true;
  }//======================================================================

function Create() {
    var status;
    var p=$("#province-input").val();
    var y=$("#year-input").val();
    var i=$("#industry-input").val();
    var v=$("#value-input").val();
    var request = $.ajax({
                url: "/api/v1/workers?apikey="+$("#api-key-input").val(),
                type: "POST",
                data: "{"+dobles_comillas+"province"+dobles_comillas+":"+dobles_comillas+c+dobles_comillas+","+dobles_comillas+"year"+dobles_comillas+":"+y+","+dobles_comillas+"industry"+dobles_comillas+":"+i+","+dobles_comillas+"value"+dobles_comillas+":"+v+"}",
                dataType: "JSON",
                contentType: "application/json"
                });
    request.done(function(data,status,jqXHR){
    console.log(JSON.stringify(data));
    var table = makeTable(data);
    //Quiero mostrar todos los elemento de DOM
    //is dumped to the console window
    console.log(table[0].outerHTML);
    $("#workers-data").html(table);

  });

  request.always(function(jqXHR,status) {
     status=jqXHR.status;
     if($("#api-key-input").val()!="sos")
     alert("Error contraseña");
     if(status == 409)
     alert("Elemento repetido");
     else
     alert("Los datos han sido almacenados");
    console.log( "Status:"+jqXHR.status);
   });
    Mostrar();
    return true;
  }

  function Edit() {
    var p=$("#province-input").val();
    var y=$("#year-input").val();
    var i=$("#industry-input").val();
    var v=$("#value-input").val();
    var request = $.ajax({
                url: "/api/v1/workers/"+y+"/"+i+"?apikey="+$("#api-key-input").val(),
                type: "PUT",
                data: "{"+dobles_comillas+"province"+dobles_comillas+":"+dobles_comillas+p+dobles_comillas+","+dobles_comillas+"year"+dobles_comillas+":"+y+","+dobles_comillas+"industry"+dobles_comillas+":"+i+","+dobles_comillas+"value"+dobles_comillas+":"+v+"}",
                dataType: "JSON",
                contentType: "application/json"
                });
    request.done(function(data,status,jqXHR){
    console.log(JSON.stringify(data));
    var table = makeTable(data);
    //Quiero mostrar todos los elemento de DOM
    //is dumped to the console window
    console.log(table[0].outerHTML);
    $("#workers-data").html(table);

  });
   request.always(function(jqXHR) {
    console.log( "Status:"+jqXHR.status);
   });
   if($("#api-key-input").val()!="sos"){
     alert("Error contraseña");
   }else{
    alert("Los datos han sido editados");
  }//Mensaje de alerta
    Mostrar();
    return true;
  }


    function Delete() {
    var p=$("#province-input").val();
    var y=$("#year-input").val();
    var i=$("#industry-input").val();
    var v=$("#value-input").val();
    var request = $.ajax({
                url: "/api/v1/workers/"+y+"/"+i+"?apikey="+$("#api-key-input").val(),
                type: "DELETE",
                data: "{"+dobles_comillas+"province"+dobles_comillas+":"+dobles_comillas+p+dobles_comillas+","+dobles_comillas+"year"+dobles_comillas+":"+y+","+dobles_comillas+"industry"+dobles_comillas+":"+i+","+dobles_comillas+"value"+dobles_comillas+":"+v+"}",
                dataType: "JSON",
                contentType: "application/json"
                });
     request.done(function(data,status,jqXHR){
    console.log(JSON.stringify(data));
    var table = makeTable(data);
    //Quiero mostrar todos los elemento de DOM
    //is dumped to the console window
    console.log(table[0].outerHTML);
    $("#workers-data").html(table);

  });
   request.always(function(jqXHR) {
    console.log( "Status:"+jqXHR.status);
   });
   if($("#api-key-input").val()!="sos"){
     alert("Error contraseña");
   }else{
    alert("El dato ha sido eliminado");
  } //Mensaje de alerta
    Mostrar();
    return true;
  }

    function Search() {
    var y=$("#year-input").val();
    var i=$("#industry-input").val();
    var request = $.ajax({
                url: "/api/v1/workers/"+y+"/"+i+"?apikey="+$("#api-key-input").val(),
                type: "GET",
                data: "",
                dataType: "JSON",
                contentType: "application/json"
                });
     request.done(function(data,status,jqXHR){
    console.log(JSON.stringify(data));
    var table = makeTable(data);
    //Quiero mostrar todos los elemento de DOM
    //is dumped to the console window
    console.log(table[0].outerHTML);
    $("#workers-data").html(table);

  });
   request.always(function(jqXHR) {
    console.log( "Status:"+jqXHR.status);
   });
   if($("#api-key-input").val()!="sos"){
     alert("Error contraseña");
  } else{
    alert("Busqueda realizada");
  }
    return true;
  }
   function List() {
    $("#workers-data").html("");
    $("#workers-data").html(
            "<thead>" +
            "<tr>" +
            "<th>Province</th>" +
            "<th>Year</th>" +
            "<th>Industry</th>" +
            "<th>Value</th>" +
            "<th>Actions</th>" +
            "</tr>" +
            "</thead>" +
            "<tbody>" +
            "</tbody>"
            ); //Agregar la tabla a la estructura HTML
        for (var i in workers ) {
            var per = workers[i];
        $("#workers tbody").append("<tr>" +
                "<td>" + per.province + "</td>" +
                "<td>" + per.year + "</td>" +
                "<td>" + per.industry + "</td>" +
                "<td>" + per.value + "</td>" +
                "<td><img src='edit.png' alt='Edit" + i + "' class='btnEdit'/>&nbsp &nbsp<img src='delete.png' alt='Delete" + i + "' class='btnDelete'/>&nbsp &nbsp<img src='lupa.png' alt='Search" + i + "' class='btnSearch'/>&nbsp &nbsp<img src='Carga.png' alt='Carga" + i + "' class='btnCarga'/></td>" +
                "</tr>"
                );
    } //Recorrer y agregar los items a la tabla HTML
  }
  $("#frmWorkers").bind("submit", function () {
    if (operation === "C")
        return Create();
    if (operation === "E")
        return Edit();
    if(operation=== "D")
        return Delete();
    if(operation=== "S")
        return Search();
    else
      return Carga();
  }); //Función para decidir si se encuentra añadiendo o editando un item
  List();
  $(".btnCarga").bind("click", function () {
    operation="L";
    $("#province-input").attr("readonly", "readonly");
    $("#year-input").attr("readonly", "readonly");
    $("#industry-input").attr("readonly", "readonly");
    $("#value-input").attr("readonly", "readonly");
    });
  $(".btnSearch").bind("click", function () {
    operation = "S";
    $("#year-input").attr("readonly", "readonly");
    $("#industry-input").attr("readonly", "readonly");
  });
  $(".btnEdit").bind("click", function () {
    operation = "E"; //"E" = Editar
    //Obtener el identificador del item a ser editado
    selected_index = parseInt($(this).attr("alt").replace("Edit", ""));
    // Convertir de JSON al formato adecuando para editarlos datos
    var per = workers[selected_index];
    $("#province-input").val(per.province);
    $("#year-input").val(per.year);
    $("#industry-input").val(per.industry);
    $("#value-input").val(per.value);
    $("#year-input").focus();
  });
  $(".btnDelete").bind("click", function () {
    operation = "D";
    //Obtener el identificador del item a ser eliminado
    selected_index = parseInt($(this).attr("alt").replace("Delete", ""));
    var per = workers[selected_index];
    $("#province-input").val(per.province);
    $("#year-input").val(per.year);
    $("#ndustry-input").val(per.industry);
    $("#txtMale").val(per.male);
    $("#province-input").attr("readonly", "readonly");
    $("#year-input").attr("readonly", "readonly");
    $("#industry-input").attr("readonly", "readonly");
    $("#value-input").attr("readonly", "readonly");
    $("#api-key-input").focus();
});
});

        </script>
        
  </head>

  <body>
    <h1>Workers Data</h1>
    <div class="container">
            <table id="workers-data" class="table"></table>
        </div>



    <button id="btnLoadInitialData">Load initial Data</button>
    <label for="api-key-input">API key</label>
    <input id="api-key-input" type="text" value="sos" />
    <button id="button-reload-data">Reload data</button>

    <form id="datum-form">
      <label for="province-input">Province</label>
      <input id="province-input" name="province" type="text" />

      <label for="year-input">Year</label>
      <input id="year-input" name="year" type="text" />

      <label for="industry-input">Industry</label>
      <input id="industry-input" name="industry" type="text" />

      <label for="value-input">Value</label>
      <input id="value-input" name="value" type="text" />

      <input id="datum-form-button" type="submit" value="Create" />
      <input id="editdatum" type="submit" value="Edit" />
      <input id="deletedatum" type="submit" value="Delete" />

    </form>
    
    <form id="server-side-search-form">
      Server side search:
      <label for="search-year-or-industry-input">Year or Industry</label>
      <input id="search-year-or-industry-input" type="text">
      <input type="submit" id="button-search" value="SEND"/>
    </form>

    <table id="workers-data" class="table">
      <thead>
        <tr>
          <th>Province</th>
          <th>Year</th>
          <th>Industry</th>
          <th>Value</th>
          
        </tr>
      </thead>
    </table>
    <div class="text-center">
<div>
  <label>Show: </label><select id="limit" onchange="paginacion()">
  </br>
  <option value="5">5</option>
  <option value="10">10</option>
  <option value="15">15</option>
  </select>

  <label>Page: </label><select id="pag" onchange="paginacion2()">
  <option value="0">1</option>
  <option value="1">2</option>
  <option value="2">3</option>
  <option value="3">4</option>
  <option value="4">5</option>
</select>
</div>
</div>

    </body>
</html>
